<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="sidebar.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <title>Dashboard Quản trị</title>
  <style>
    /* Hiệu ứng nổi chung */
.stat-card:hover,
.review-card:hover,
.section-box:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  z-index: 2;
}

    * {
  transition: all 0.2s ease-in-out;
}

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      background: #e9f1fb;
      display: flex;
      overflow-x: hidden;
    }
    .sidebar {
  width: 220px;
  background: linear-gradient(145deg, #2170b9, #3d78f7);
  color: #eee;


 
  padding: 30px 20px;
  font-size: 16px;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  overflow-y: auto;
  z-index: 10;
  color: white;
  box-shadow: 4px 0 8px rgba(0, 0, 0, 0.1);
}

.sidebar h3 {
  color: #fff;
}

.sidebar a {
  text-decoration: none;
  color: white;
  margin: 10px 0;
  display: block;
  padding: 12px 14px;
  border-radius: 10px;
  transition: all 0.25s ease;
  font-weight: 500;
  position: relative;
}

.sidebar a:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-weight: bold;
  color: #ffe8ff;
}

.sidebar a i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

   .main {
  margin-left: 220px;     /* chiều rộng sidebar */
  margin-right: 400px;    /* chiều rộng right-panel */
  padding: 30px;
  min-height: 100vh;
  padding-bottom: 120px;  /* tránh bị đè lên cuối */
  position: relative;
  z-index: 1;
}

    .greeting {
      margin-top: 50px;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 40px;
    }
    .top-info {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }
    .top-info img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 3px solid #2b8cf9;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .clock-box {
      flex: 1;
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      color: white;
      height: 150px;
      padding: 50px;
      border-radius: 16px;
      background: url('/assets/img/clock.jpeg') center/cover no-repeat;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .stat-card {
      background: #ffffff;
      padding: 30px 20px;
      border-radius: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      text-align: center;
      height: 180px;
    }
    .stat-number {
      font-size: 32px;
      font-weight: bold;
      color: #2b8cf9;
    }
    .stat-label {
      margin-top: 12px;
      font-size: 17px;
    }
    .customer-reviews {
      margin-top: 40px;
    }
    .customer-reviews h3 {
      font-size: 20px;
      margin-bottom: 20px;
    }
    .review-grid {
       display: flex;
       gap: 17px;
       justify-content: space-between;
}

    .review-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 20px;
      width: 200px;
      height: 180px;
      position: relative;
    }
    .review-header {
      display: flex;
      align-items: center;
      gap: 40px;
      margin-bottom: 10px;
    }
    .review-header img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .review-card p {
      font-size: 14px;
      margin: 10px 0;
    }
    .stars {
      color: #f4c150;
      font-size: 16px;
    }
    .stars span {
      color: #555;
      font-size: 14px;
    }
    .review-card .dish {
      width: 50px;
      border-radius: 50%;
      position: absolute;
      right: -30px;
      top: 20px;
      border: 6px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .right-panel {
  width: 390px;
  padding: 20px;
  background: #f5f9ff;
  border-left: 1px solid #ddd;
  display: flex;
  flex-direction: column;
  gap: 20px;
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  overflow-y: auto;
  z-index: 5;
}

    .section-box {
      background: #ebfaf0;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      min-height: 350px;
    }
    .calendar {
      background: url('/assets/img/calendar.jpg') center/cover no-repeat;
      border: 1px solid #ccd9ed;
      padding: 10px;
    }
    .calendar .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      font-size: 13px;
      text-align: center;
    }
    .calendar .day {
      background: rgba(255,255,255,0.8);
      padding: 8px;
      border-radius: 8px;
      backdrop-filter: blur(2px);
      transition: 0.2s;
    }
    .calendar .day:hover {
      background-color: #cde7ff;
    }
    .msg {
      display: flex;
      align-items: center;
      margin-bottom: 14px;
    }
    .msg img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .msg .info {
      font-size: 14px;
    }
    @media (max-width: 992px) {
      .stats {
        grid-template-columns: 1fr 1fr;
      }
      .right-panel {
        display: none;
      }
    }
    .days > div {
  padding: 8px;
  text-align: center;
  user-select: none;
}

.days > div.day:hover {
  background-color: #d0e6ff;
  cursor: pointer;
}

.days > div.today {
  background-color: #2b8cf9;
  color: white;
  border-radius: 50%;
}

  </style>
</head>
<body>
   <!-- Sidebar sẽ được chèn động -->
  <div id="sidebar-container"></div>

  <div class="main">
    <div class="greeting">Xin chào, Quản trị viên!</div>
    <div class="top-info">
      <img src="/assets/img/admin.jpeg" alt="Admin Avatar">
      <div class="clock-box">
        <div id="currentTime">--:--:--</div>
      </div>
    </div>
    <div class="stats">
      <a href="/pages/employees.html" style="text-decoration: none;">
        <div class="stat-card">
        <div class="stat-number" id="totalEmployees">0</div>
        <div class="stat-label">Nhân viên</div>
      </div>
      </a>
      <a href="/pages/tables.html" style="text-decoration: none;">
      <div class="stat-card">
        <div class="stat-number" id="totalTables">0</div>
        <div class="stat-label">Bàn ăn</div>
      </div>
      </a>
      <a href="/pages/invoices.html" style="text-decoration: none;">
      <div class="stat-card">
        <div class="stat-number" id="todayOrders">0</div>
        <div class="stat-label">Đơn hôm nay</div>
      </div>
      </a>
      <div class="stat-card">
        <div class="stat-number" id="monthlyRevenue">0</div>
        <div class="stat-label">Doanh thu tháng</div>
      </div>
    </div>
     <div style="margin-top: 50px;">
  <h3 style="margin-bottom: 15px;">Biểu đồ doanh thu theo tháng</h3>
  <div style="height: 300px; width: 100%; max-width: 900px;">
    <canvas id="monthlyRevenueChart"></canvas>
  </div>
</div>


    <div class="customer-reviews">
      <h3>Đánh giá khách hàng</h3>
      <div class="review-grid">
        <div class="review-card">
          <div class="review-header">
            <img src="https://i.pravatar.cc/40?u=stepni" alt="avatar">
            <div><strong>Stepni Doe</strong><br><small>3 ngày trước</small></div>
          </div>
          <p>Rất hài lòng với món ăn, hương vị đậm đà và phục vụ tận tình!</p>
          <div class="stars">★★★★★ <span>4.5</span></div>
          <img class="dish" src="https://images.unsplash.com/photo-1600891964599-f61ba0e24092" alt="dish">
        </div>
        <div class="review-card">
          <div class="review-header">
            <img src="https://i.pravatar.cc/40?u=rehan" alt="avatar">
            <div><strong>Rehan Doe</strong><br><small>4 ngày trước</small></div>
          </div>
          <p>Không gian đẹp, món tráng miệng ngon tuyệt. Sẽ quay lại lần nữa.</p>
          <div class="stars">★★★★★ <span>4.5</span></div>
          <img class="dish" src="https://mediawinwin.vn/upload/images/sanpham/bao-gia-chup-mon-an-dich-vu-chup-anh-do-an-chuyen-nghiep-5.JPG" alt="dish">
        </div>
        <div class="review-card">
          <div class="review-header">
            <img src="https://i.pravatar.cc/40?u=lisa" alt="avatar">
            <div><strong>Lisa Tran</strong><br><small>2 ngày trước</small></div>
          </div>
          <p>Thực đơn phong phú, giá hợp lý. Nhân viên thân thiện và nhiệt tình.</p>
          <div class="stars">★★★★★ <span>4.8</span></div>
          <img class="dish" src="https://mediawinwin.vn/upload/images/sanpham/bao-gia-chup-mon-an-dich-vu-chup-anh-do-an-chuyen-nghiep-3.JPG" alt="dish">
        </div>
      </div>
    </div>
  </div>

  <div class="right-panel">
    <div class="section-box calendar">
  <h3>Lịch</h3>
  <div class="calendar-header" style="display:flex; justify-content:center; align-items:center; gap:15px; margin-bottom:10px;">
    <button id="prevMonth" style="cursor:pointer;">&lt;</button>
    <span id="monthYear" style="font-weight:bold; font-size:16px;"></span>
    <button id="nextMonth" style="cursor:pointer;">&gt;</button>
  </div>
  <div class="days" id="calendarDays" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:5px;"></div>
</div>

    <div class="section-box" style="flex-grow: 2;">
      <h3>Tin nhắn</h3>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=a"><div class="info"><b>Mai</b><br>Báo cáo mới gửi nhé</div></div>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=b"><div class="info"><b>Nam</b><br>Đặt bàn VIP lúc 6h</div></div>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=c"><div class="info"><b>Thu</b><br>Nhớ kiểm tra kho</div></div>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=d"><div class="info"><b>Quản lý</b><br>Lịch họp 10h sáng mai</div></div>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=e"><div class="info"><b>Chef</b><br>Thêm nguyên liệu mới</div></div>
      <div class="msg"><img src="https://i.pravatar.cc/36?u=f"><div class="info"><b>Khách</b><br>Phản hồi món ăn tốt</div></div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Load sidebar
  fetch('sidebar.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('sidebar-container').innerHTML = html;
      const basePath = window.location.pathname.includes('/pages/') ? '../' : './';
      document.querySelectorAll('.sidebar a').forEach(link => {
        const href = link.getAttribute('data-href');
        if (href) link.setAttribute('href', basePath + href);
      });
    });

  // Đồng hồ thời gian
  function updateTimeOnly() {
    const now = new Date();
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
    document.getElementById('currentTime').textContent = now.toLocaleTimeString('vi-VN', timeOptions);
  }

  // Đếm động các con số
  function animateCount(id, target) {
    const el = document.getElementById(id);
    let count = 0;
    const step = Math.ceil(target / 40);
    const timer = setInterval(() => {
      count += step;
      if (count >= target) {
        count = target;
        clearInterval(timer);
      }
      el.textContent = id === 'monthlyRevenue' ? count.toLocaleString('vi-VN') + '₫' : count;
    }, 20);
  }

  // Tải dữ liệu thống kê dashboard
  function loadStatistics() {
    fetch('/api/dashboard/stats')
      .then(res => res.json())
      .then(data => {
        animateCount('totalEmployees', data.totalEmployees);
        animateCount('totalTables', data.totalTables);
        animateCount('todayOrders', data.todayOrders);
        animateCount('monthlyRevenue', data.monthlyRevenue);
      })
      .catch(err => console.error('Lỗi khi tải thống kê:', err));
  }

  // Vẽ biểu đồ cột doanh thu theo tháng
  function loadMonthlyRevenueChart() {
    fetch('/api/dashboard/monthly-revenue')
      .then(res => res.json())
      .then(data => {
        const labels = data.map(item => item.month);
        const values = data.map(item => item.total);

        const ctx = document.getElementById('monthlyRevenueChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, '#2b8cf9');
        gradient.addColorStop(1, '#a0c8ff');

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Doanh thu (VNĐ)',
              data: values,
              backgroundColor: gradient,
              borderRadius: 8,
              barThickness: 30,
              maxBarThickness: 40
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#2b8cf9',
                titleColor: '#fff',
                bodyColor: '#fff',
                callbacks: {
                  label: function (context) {
                    return ' ' + context.parsed.y.toLocaleString('vi-VN') + ' ₫';
                  }
                }
              }
            },
            scales: {
              x: {
                ticks: { font: { size: 14 } },
                grid: { display: false }
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString('vi-VN') + ' ₫';
                  },
                  font: { size: 13 }
                }
              }
            }
          }
        });
      })
      .catch(err => console.error('Lỗi khi tải dữ liệu biểu đồ:', err));
  }

  // Xử lý lịch tháng
  let currentDate = new Date();

  function updateCalendarHeader() {
    const monthYear = document.getElementById('monthYear');
    monthYear.textContent = currentDate.toLocaleDateString('vi-VN', { month: 'long', year: 'numeric' });
  }

  function generateCalendar(date) {
    const container = document.getElementById("calendarDays");
    container.innerHTML = "";
    const year = date.getFullYear();
    const month = date.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDay = new Date(year, month, 1).getDay();
    const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    dayNames.forEach(d => {
      const el = document.createElement("div");
      el.innerHTML = `<b>${d}</b>`;
      container.appendChild(el);
    });

    for (let i = 0; i < firstDay; i++) {
      container.appendChild(document.createElement("div"));
    }

    for (let d = 1; d <= daysInMonth; d++) {
      const el = document.createElement("div");
      el.className = "day";
      el.textContent = d;
      const today = new Date();
      if (
        d === today.getDate() &&
        month === today.getMonth() &&
        year === today.getFullYear()
      ) {
        el.style.background = "#2b8cf9";
        el.style.color = "#fff";
      }
      container.appendChild(el);
    }
  }

  document.getElementById('prevMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    updateCalendarHeader();
    generateCalendar(currentDate);
  });

  document.getElementById('nextMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    updateCalendarHeader();
    generateCalendar(currentDate);
  });

  // Gọi các hàm khi load
  setInterval(updateTimeOnly, 1000);
  updateTimeOnly();
  updateCalendarHeader();
  generateCalendar(currentDate);
  loadStatistics();
  loadMonthlyRevenueChart();
</script>


</body>
</html>